<html>
	<head>
		<link rel="stylesheet" type="text/css" href="./style.css">
	</head>
	<body>
	<h1>Creating a Rhino plug-in</h1>
<p>Introduction into writing a Rhino plug-in. For this plug-in we are going to use
Visual Studio Code and dotnet tools.</p>
<h2>Creating the project</h2>
<p>Since the plug-in is essentially a DLL, with the extension renamed to RHP, we
create a classlib template project.</p>
<pre><code><span class="hljs-built_in">PS</span>&gt; dotnet new classlib
</code></pre>
<p>To have the generated project compile as a Rhino plug-in, we need to make some
changes to the project file. Rhino 7 targets itself .NET 4.8 framework, so we
are going to do the same.</p>
<p>This also means that we need to disable the C# 10 features.</p>
<p>We also need to tell the project that we want an RHP file, not a DLL. For this
we are going to use the <code>&lt;TargetExt&gt;</code> tag.</p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-name">TargetExt</span>&gt;</span>.rhp<span class="hljs-tag">&lt;/<span class="hljs-name">TargetExt</span>&gt;</span>
</code></pre>
<p>We also want to control the project management manually. This means we need to
disable default items, as well as disable automatic assembly information
generation. This can be done with the tags <code>&lt;EnableDefaultItems&gt;</code> and
<code>&lt;GenerateAssemblyInfo&gt;</code>.</p>
<pre><code><span class="hljs-tag">&lt;<span class="hljs-name">EnableDefaultItems</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-name">EnableDefaultItems</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">GenerateAssemblyInfo</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-name">GenerateAssemblyInfo</span>&gt;</span>
</code></pre>
<p>To be able to use RhinoCommon SDK we need to add the RhinoCommon package
reference from NuGet. The current version we are going to use is
7.12.21313.6341.</p>
<h2>Creating the plug-in class</h2>
<p>A Rhino plug-in derives from one of the plug-in classes that is provided by the
<code>Rhino.PlugIns</code> namespace. There are several available, for import, export, and
so. But our case we are going to do just a simple utility plug-in. Such plug-in
derives from <code>Rhino.PlugIns.PlugIn</code>.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;jesterLiveCode plug-in.*&gt;&gt;=</div><div class="code"><pre><code><span class="hljs-keyword">using</span> Rhino;
<span class="hljs-keyword">using</span> Rhino.PlugIns;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">jesterLiveCode</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">jesterLiveCodePlugin</span> : <span class="hljs-title">PlugIn</span>
    {
        &lt;&lt;jesterLiveCode plug-<span class="hljs-keyword">in</span> construction&gt;&gt;
    }
}
</code></pre>
</div></div><p>Rhino plug-ins are going to be initialized by Rhino, and for plug-ins there
should always be only one instance. So a singleton pattern here is going to be
needed.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;jesterLiveCode plug-in construction&gt;&gt;=</div><div class="code"><pre><code><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">jesterLiveCodePlugin</span>(<span class="hljs-params"></span>)</span>
{
    <span class="hljs-keyword">if</span>(Instance == <span class="hljs-literal">null</span>)
    {
        Instance = <span class="hljs-keyword">this</span>;
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> jesterLiveCodePlugin Instance { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>; }
</code></pre>
</div></div><h2>Setting up the assembly information</h2>
<p>For to be able to load the plug-in properly the correct assembly attributes need
to be present. The <code>PlugInDescription</code> attribute needs to be set with several
different types. Also the assembly needs to have a unique GUID. And finally
there needs to be file versioning.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;jesterLiveCode assembly info.*&gt;&gt;=</div><div class="code"><pre><code><span class="hljs-keyword">using</span> System.Reflection;
<span class="hljs-keyword">using</span> System.Runtime.CompilerServices;
<span class="hljs-keyword">using</span> System.Runtime.InteropServices;
<span class="hljs-keyword">using</span> Rhino.PlugIns;
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.Address, <span class="hljs-string">&quot;Turku&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.Country, <span class="hljs-string">&quot;Finland&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.Email, <span class="hljs-string">&quot;jesterking@letwory.net&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.Phone, <span class="hljs-string">&quot;-&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.Fax, <span class="hljs-string">&quot;-&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.Organization, <span class="hljs-string">&quot;Letwory Interactive Oy&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.UpdateUrl, <span class="hljs-string">&quot;-&quot;</span>)</span>]
[<span class="hljs-meta">assembly: PlugInDescription(DescriptionType.WebSite, <span class="hljs-string">&quot;https://www.letworyinteractive.com&quot;</span>)</span>]


[<span class="hljs-meta">assembly: AssemblyTitle(<span class="hljs-string">&quot;jesterLiveCode&quot;</span>)</span>] <span class="hljs-comment">// Plug-In title is extracted from this</span>
[<span class="hljs-meta">assembly: AssemblyDescription(<span class="hljs-string">&quot;A plug-in showing the ropes of writing code for Rhino.&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyConfiguration(<span class="hljs-string">&quot;&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyCompany(<span class="hljs-string">&quot;Letwory Interactive Oy&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyProduct(<span class="hljs-string">&quot;&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyCopyright(<span class="hljs-string">&quot;Copyright Â©  2021&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyTrademark(<span class="hljs-string">&quot;&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyCulture(<span class="hljs-string">&quot;&quot;</span>)</span>]

<span class="hljs-comment">// Setting ComVisible to false makes the types in this assembly not visible</span>
<span class="hljs-comment">// to COM components.  If you need to access a type in this assembly from</span>
<span class="hljs-comment">// COM, set the ComVisible attribute to true on that type.</span>
[<span class="hljs-meta">assembly: ComVisible(false)</span>]

<span class="hljs-comment">// The following GUID is for the ID of the typelib if this project is exposed to COM</span>
[<span class="hljs-meta">assembly: Guid(<span class="hljs-string">&quot;0fda72f0-ccd3-4b75-8896-f495ae82fc18&quot;</span>)</span>]
<span class="hljs-comment">// Version information for an assembly consists of the following four values:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//      Major Version</span>
<span class="hljs-comment">//      Minor Version</span>
<span class="hljs-comment">//      Build Number</span>
<span class="hljs-comment">//      Revision</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// You can specify all the values or you can default the Build and Revision Numbers</span>
<span class="hljs-comment">// by using the &#x27;*&#x27; as shown below:</span>
<span class="hljs-comment">// [assembly: AssemblyVersion(&quot;1.0.*&quot;)]</span>
[<span class="hljs-meta">assembly: AssemblyVersion(<span class="hljs-string">&quot;0.0.1.0&quot;</span>)</span>]
[<span class="hljs-meta">assembly: AssemblyFileVersion(<span class="hljs-string">&quot;0.0.1.0&quot;</span>)</span>]
</code></pre>
</div></div><h2>Creating a command</h2>
<p>A command in Rhino derives from <code>Rhino.Commands.Command</code>. There two mandatory
parts for a command to implement to get a minimal implementation.</p>
<p>For this command we are going to start a fragment where we are going to collect
all the namespace usages.</p>
<p>We need at least the <code>Rhino.Commands</code> namespace. And lets also bring in <code>Rhino</code>,
since that is where <code>RhinoDoc</code> lives.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;first command usings&gt;&gt;=</div><div class="code"><pre><code><span class="hljs-keyword">using</span> Rhino;
<span class="hljs-keyword">using</span> Rhino.Commands;
</code></pre>
</div></div><p>Our command class is going to be called <code>jesterLiveCodeCommandOne</code>, primarily
due to lack of imagination.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;first command class.*&gt;&gt;=</div><div class="code"><pre><code>&lt;&lt;first command usings&gt;&gt;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">jesterLiveCode</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">jesterLiveCodeCommandOne</span> : <span class="hljs-title">Command</span>
    {
        &lt;&lt;first command overrides&gt;&gt;
    }
}
</code></pre>
</div></div><h3>The mandatory overrides for a Command class</h3>
<p>To get a minimal working <code>Command</code> the property <code>EnglishName</code>. This property will essentially be the name of the command as you type it into the Rhino command-line.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;first command overrides&gt;&gt;=</div><div class="code"><pre><code><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">string</span> EnglishName =&gt; <span class="hljs-string">&quot;jesterLiveCodeCommandOne&quot;</span>;
</code></pre>
</div></div><p>We also need to override the method <code>RunCommand</code>, which is going to be the actual meat of the command. Here the driving logic of the command will live. For now we are going to print a simple message.</p>
<div class="codefragment"><div class="fragmentname">&lt;&lt;first command overrides&gt;&gt;=+</div><div class="code"><pre><code><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> Result <span class="hljs-title">RunCommand</span>(<span class="hljs-params">RhinoDoc doc, RunMode mode</span>)</span>
{
    RhinoApp.WriteLine(<span class="hljs-string">&quot;jesterLiveCodeCommandOne`. says hello&quot;</span>);
    <span class="hljs-keyword">return</span> Result.Success;
}
</code></pre>
</div></div>
	</body>
</html>